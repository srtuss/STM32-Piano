#include "filter.h"

/**
 *
 *                 [HP]
 *                  |
 * [-kQ] >---------------+                     [BP]
 *                  |    |                      |
 *                  |   _v_                     |
 *              +-------_*_<------+-------------+             +--------------+
 *              |   |             |             |             |              |
 *             _v_  |   ___      _v_    _____   |   ___      _v_      _____  |
 * [IN] >----->_+_--+-->_*_----->_+_--->_T-1_---+-->_*_----->_+_--+-->_T-1_--+
 *              ^        ^                           ^            |
 *          (-) |        |                           |            |
 *              +--------|---------------------------|------------+-------[LP]
 *                       |                           |
 * [kF] >----------------+---------------------------+
 *
 *
 */

void filter_clock(filter_s* s, float in) {

	float t1 = s->lp + s->kF * s->bp;
	s->hp = in - t1 - s->kQ * s->bp;
	s->bp += s->kF * s->hp;
	s->lp = t1;
}

void filter_init(filter_s* s) {
	s->hp = 0;
	s->lp = 0;
	s->bp = 0;
	s->kQ = .2f;
	s->kF = .5f;
}
